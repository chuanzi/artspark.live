# Context
Filename: TASK_HIDE_REFERENCE_IMAGE_UPLOAD.md
Created On: 2024-12-22 14:00
Created By: User/AI  
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
隐藏portrait工具中的上传参考图功能。这个功能效果不好，暂时去掉。

# Project Overview
Artspark网站的AI肖像生成工具页面，需要临时隐藏参考图上传功能模块，因为该功能目前效果不佳。

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)
## 参考图上传功能当前实现分析：

### 文件位置：
- 主要实现文件：`app/tools/portrait/page.tsx`

### 功能组件分析：
1. **状态管理**：
   - `referenceImage` state (第30行)：存储上传的参考图base64数据
   - 默认值为null

2. **核心函数**：
   - `handleFileUpload` (第110-125行)：处理文件上传逻辑
   - `removeReferenceImage` (第125-127行)：移除已上传的参考图

3. **UI组件** (第475-519行)：
   - 位于"上传参考图（可选）"部分
   - 包含两种状态：已上传显示预览+删除按钮，未上传显示虚线边框上传区域
   - 使用Upload图标和文件input元素

4. **与生成逻辑的集成**：
   - `handleGenerate`函数中的验证逻辑：允许仅有参考图而无文字描述
   - 按钮disabled条件：`(!characterDescription.trim() && !referenceImage) || isGenerating`
   - API参数传递：`referenceImage`参数会传递给后端API

5. **后端API支持**：
   - 从任务记录文件可看到，后端已实现referenceImage参数处理
   - API路由：`/api/generate-portrait`支持referenceImage参数

### 依赖的导入：
- `Upload, X` 图标来自lucide-react
- `Image` 组件来自next/image

### 涉及的样式和布局：
- 整个组件采用白色卡片样式，与其他功能模块布局一致
- 使用了石色主题的边框和背景色
- 上传区域采用虚线边框设计 

# Proposed Solution (Populated by INNOVATE mode)

## 解决方案评估：

### 方案1：完全删除相关代码
**优点：** 代码更简洁，没有冗余代码，减少包体积
**缺点：** 将来重新启用需要重新实现，可能丢失实现细节，改动较大

### 方案2：条件隐藏UI组件  
**优点：** 保留底层逻辑，便于将来重新启用，代码变更最小，易于维护
**缺点：** 保留了暂时不用的代码

### 方案3：注释禁用方式
**优点：** 快速禁用功能，保留代码备用，改动中等
**缺点：** 代码结构不够清晰，注释代码可能造成混乱

### 方案4：CSS样式隐藏
**优点：** 改动最小，实现快速
**缺点：** 用户可通过开发者工具看到，不够彻底，仍有交互逻辑存在

## 推荐解决方案：

采用**方案2：条件隐藏UI组件**，原因如下：

1. **符合暂时性需求**：用户明确表示"暂时去掉"，暗示未来可能重新启用
2. **最小化风险**：保留所有底层逻辑和API支持，避免破坏现有功能
3. **易于维护**：通过功能开关控制，逻辑清晰，便于管理
4. **快速实现**：只需添加条件判断，改动最小

## 具体实现策略：

1. **添加功能开关常量**：
   - 在页面顶部定义`const ENABLE_REFERENCE_IMAGE = false`

2. **条件隐藏UI组件**：
   - 用条件渲染包围整个"上传参考图"模块
   - 保留所有状态和函数不变

3. **调整验证逻辑**：
   - 修改生成按钮的disabled条件，去除对referenceImage的依赖
   - 更新handleGenerate函数的验证逻辑，只检查文字描述

4. **保持API兼容性**：
   - 保留referenceImage相关的API调用代码
   - 确保后端接口不受影响 

# Implementation Plan (Generated by PLAN mode)

## 详细技术规范：

### 文件修改路径：
- `app/tools/portrait/page.tsx`：主要修改文件

### 功能开关实现：
- 添加常量：`const ENABLE_REFERENCE_IMAGE = false`
- 位置：组件函数内部顶部，与其他常量一起

### UI组件条件渲染：
- 目标代码段：第475-519行的"Reference Image Upload"模块
- 包围条件：`{ENABLE_REFERENCE_IMAGE && (整个参考图上传组件)}`
- 保持其他功能模块的位置和布局不变

### 验证逻辑修改：
- `handleGenerate`函数验证条件变更：
  - 原：`!characterDescription.trim() && !referenceImage`
  - 新：`!characterDescription.trim()`
- 错误消息更新：
  - 原：`"请提供人物描述或上传参考图"`
  - 新：`"请输入人物描述"`
- 生成按钮disabled条件：
  - 原：`(!characterDescription.trim() && !referenceImage) || isGenerating`
  - 新：`!characterDescription.trim() || isGenerating`

### 保持不变的元素：
- `referenceImage`状态定义保持不变
- `handleFileUpload`和`removeReferenceImage`函数保持不变
- 所有导入语句保持不变
- API调用逻辑保持不变

### 代码质量要求：
- 保持现有代码风格和格式
- 使用现有的错误处理模式
- 维持组件的响应式设计
- 确保TypeScript类型安全

Implementation Checklist:
1. 在`app/tools/portrait/page.tsx`文件顶部添加功能开关常量`const ENABLE_REFERENCE_IMAGE = false`
2. 找到"Reference Image Upload"组件部分（第475-519行），用条件渲染`{ENABLE_REFERENCE_IMAGE && (...)}` 包围整个模块
3. 修改`handleGenerate`函数中的验证逻辑，将条件从`!characterDescription.trim() && !referenceImage`改为`!characterDescription.trim()`
4. 更新验证失败时的错误消息，从"请提供人物描述或上传参考图"改为"请输入人物描述"
5. 修改生成按钮的disabled条件，从`(!characterDescription.trim() && !referenceImage) || isGenerating`改为`!characterDescription.trim() || isGenerating`
6. 测试功能：确认参考图上传模块不显示，且仅文字描述可以正常生成图片 

# Current Execution Step (Updated by EXECUTE mode when starting a step)
> Currently executing: "Step 6 - Testing and verification"

# Task Progress (Appended by EXECUTE mode after each step completion)
* 2024-12-22 14:15
  * Step: 1. 添加功能开关常量
  * Modifications: app/tools/portrait/page.tsx: 在组件函数内顶部添加 `const ENABLE_REFERENCE_IMAGE = false`
  * Change Summary: 添加了控制参考图上传功能显示的功能开关
  * Reason: 执行计划步骤1
  * Blockers: None
  * Status: [Pending Confirmation]

* 2024-12-22 14:16
  * Step: 2. 条件隐藏参考图上传组件
  * Modifications: app/tools/portrait/page.tsx: 用 `{ENABLE_REFERENCE_IMAGE && (...)}` 包围整个参考图上传模块
  * Change Summary: 参考图上传UI组件已通过条件渲染隐藏
  * Reason: 执行计划步骤2
  * Blockers: None
  * Status: [Pending Confirmation]

* 2024-12-22 14:17
  * Step: 3. 修改验证逻辑
  * Modifications: app/tools/portrait/page.tsx: 修改handleGenerate函数验证条件从 `!characterDescription.trim() && !referenceImage` 改为 `!characterDescription.trim()`，错误消息改为"请输入人物描述"
  * Change Summary: 简化了验证逻辑，只检查文字描述，更新了错误提示文案
  * Reason: 执行计划步骤3和4
  * Blockers: None
  * Status: [Pending Confirmation]

* 2024-12-22 14:18
  * Step: 5. 修改生成按钮disabled条件
  * Modifications: app/tools/portrait/page.tsx: 修改按钮disabled条件从 `(!characterDescription.trim() && !referenceImage) || isGenerating` 改为 `!characterDescription.trim() || isGenerating`
  * Change Summary: 更新了按钮禁用逻辑，去除对参考图状态的依赖
  * Reason: 执行计划步骤5
  * Blockers: None
  * Status: [Pending Confirmation] 